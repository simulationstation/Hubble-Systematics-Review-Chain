run:
  run_id: pantheon_plus_shoes_ladder_demo_v3
  out_base: outputs
  tasks:
    - baseline_fit
    - cut_scan
    - correlated_cut_null
    - injection_suite
    - split_fit
    - sbc
    - report

anchor:
  # Early-time style anchor (Planck18-ish flat LCDM).
  H0: 67.4
  Omega_m: 0.315
  Omega_k: 0.0
  rd_Mpc: 147.09

probe:
  name: pantheon_plus_shoes_ladder
  raw_dat_path: data/raw/pantheon_plus_shoes/Pantheon+SH0ES.dat
  raw_cov_path: data/raw/pantheon_plus_shoes/Pantheon+SH0ES_STAT+SYS.cov
  # Recreate the SH0ES-like "calibrator + Hubble-flow" sample.
  include_calibrators: true
  include_hubble_flow: true
  z_column: zHD
  z_hf_min: 0.023
  z_hf_max: 0.15

model:
  # Ladder levels (for this adapter):
  # - L0: no systematics parameters (diagnostic only)
  # - L1: global offset (M_B-like)
  # - L2: L1 + survey offsets
  # - L3: L2 + smooth Hubble-flow-only z residual (regularized)
  # - L4: L3 + sky low-â„“ modes (regularized; RA/DEC ICRS basis)
  ladder_level: L2
  shared_scale:
    # "Distance-scale stress-test": allow an H0-like scaling on Hubble-flow rows only.
    enable: true
    params: [delta_lnH0]
    # Wide prior in ln(H0/H0_anchor) for audit runs.
    prior_sigma: 0.5
  priors:
    # Wide prior for M_B-like offset (natural scale ~-19 mag).
    sigma_global_offset_mag: 10.0
    sigma_survey_offset_mag: 0.2
    sigma_z_spline_mag: 0.2
    sigma_z_spline_d2_mag: 0.2
    sigma_sky_mode_mag: 0.2

scan:
  # Scan the maximum Hubble-flow redshift (calibrators are always included).
  cut_var: z_hf_max
  n_cuts: 12
  cut_min: 0.05
  cut_max: 0.15

null:
  n_mc: 200
  seed: 123
  drift_param: delta_lnH0
  use_diagonal_errors: true

injection:
  seed: 123
  n_mc: 200
  use_diagonal_errors: true
  # Calibrator-only systematic in m_b_corr (can be interpreted as a calibrator-side magnitude
  # bias, or equivalently an opposite-sign distance-modulus bias in the calibrator distance anchor).
  mechanism: calibrator_offset_mag
  amplitudes: [-0.20, -0.10, 0.0, 0.10, 0.20]
  param_of_interest: delta_lnH0

sbc:
  seed: 123
  n_rep: 256
  use_diagonal_errors: true

split_fit:
  ladder_level: L1
  split_var: idsurvey
  mode: categories
  param: delta_lnH0
  use_diagonal_errors: true
