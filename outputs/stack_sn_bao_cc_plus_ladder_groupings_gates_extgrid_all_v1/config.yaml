run:
  run_id: stack_sn_bao_cc_plus_ladder_groupings_gates_extgrid_all_v1
  out_base: outputs
  tasks:
    - baseline_sweep
    - report

anchor:
  H0: 67.4
  Omega_m: 0.315
  Omega_k: 0.0
  rd_Mpc: 147.09

model:
  shared_scale:
    enable: true
    params: [delta_lnH0]
    prior_sigma: 0.5

probe:
  name: stack
  stack:
    - name: pantheon_plus
      data_path: data/processed/pantheon_plus/pantheon_plus_sky_cosmology_stat+sys_zHD.npz
      z_min: 0.02
      z_max: 0.62
      model:
        ladder_level: L2
        priors:
          sigma_global_offset_mag: 10.0
          sigma_survey_offset_mag: 0.2

    - name: pantheon_plus_shoes_ladder
      raw_dat_path: data/raw/pantheon_plus_shoes/Pantheon+SH0ES.dat
      raw_cov_path: data/raw/pantheon_plus_shoes/Pantheon+SH0ES_STAT+SYS.cov
      include_calibrators: true
      include_hubble_flow: true
      z_column: zHD
      z_hf_min: 0.023
      z_hf_max: 0.15
      model:
        ladder_level: L2
        priors:
          sigma_global_offset_mag: 10.0
          sigma_survey_offset_mag: 0.2
          sigma_calibrator_offset_mag: 0.2

    - name: bao
      data_path: data/processed/bao/bao_desi_2024_bao_all.npz
      meta_path: data/processed/bao/bao_desi_2024_bao_all.meta.json
      model:
        ladder_level: L0

    - name: chronometers
      data_path: data/processed/chronometers/chronometers_BC03_all.npz
      model:
        ladder_level: L0

    # External late-time H0 constraints (grid posteriors; stress-test only).
    - name: h0_grid
      label: trgb_freedman_2021_review
      data_path: data/processed/h0_grids/trgb_freedman_2021_review.json
      space: ln
      model:
        ladder_level: L0

    - name: h0_grid
      label: tdcosmo_slacs_birrer_2020
      data_path: data/processed/h0_grids/tdcosmo_slacs_birrer_2020.json
      space: ln
      model:
        ladder_level: L0

    - name: h0_grid
      label: h0licow_wong_2020
      data_path: data/processed/h0_grids/h0licow_wong_2020.json
      space: ln
      model:
        ladder_level: L0

    - name: h0_grid
      label: megamaser_pesce_2020
      data_path: data/processed/h0_grids/megamaser_pesce_2020.json
      space: ln
      model:
        ladder_level: L0

sweep:
  - label: baseline_no_cal_offset
    model: {}

  - label: baseline_plus_cal_offset
    stack_overrides:
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}

  # Systematic-group covariance priors from Pantheon+SH0ES sytematic_groupings/*.cov
  # (derived via scripts/derive_pantheon_shoes_cov_priors.py).
  - label: group_BS21_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_BS21_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_BS21_v1.json

  - label: group_C11_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_C11_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_C11_v1.json

  - label: group_CALIB_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_CALIB_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_CALIB_v1.json

  - label: group_CSP_RECAL_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_CSP_RECAL_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_CSP_RECAL_v1.json

  - label: group_G10_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_G10_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_G10_v1.json

  - label: group_HSTCALSPEC_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_HSTCALSPEC_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_HSTCALSPEC_v1.json

  - label: group_JLA_SALT2_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_JLA_SALT2_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_JLA_SALT2_v1.json

  - label: group_MASSSTEP_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MASSSTEP_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MASSSTEP_v1.json

  - label: group_MWCOLORLAW_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MWCOLORLAW_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MWCOLORLAW_v1.json

  - label: group_MWEBV_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MWEBV_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_MWEBV_v1.json

  - label: group_SCATTERMOD_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_SCATTERMOD_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_SCATTERMOD_v1.json

  - label: group_SPECEFF_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_SPECEFF_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_SPECEFF_v1.json

  - label: group_VPEC_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_VPEC_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_VPEC_v1.json

  - label: group_ZSHIFT_cal_offset
    stack_overrides:
      pantheon_plus:
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_ZSHIFT_v1.json
      pantheon_plus_shoes_ladder:
        mechanisms: {calibrator_offset: true}
        priors:
          sigma_overrides_path: data/processed/external_calibration/pantheon_plus_shoes_sigma_overrides_from_group_ZSHIFT_v1.json

